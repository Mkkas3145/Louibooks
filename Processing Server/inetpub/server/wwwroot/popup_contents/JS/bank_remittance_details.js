



function getHtmlPopupContents_bank_remittance_details() {
    let html = "";

    let country = userLocation;
    let back = getPopupBankRemittanceBankSelectItems(country);

    html = `
        <div class = "edit_profile_picture">
            <div class = "popup_contents_top">
                <div class = "popup_contents_top_left md-ripples" onclick = "backPopupContents();" onmouseenter = "hoverInformation(this, getLanguage('popup_contents:back'));">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0 0 50 50"><defs><clipPath id="b"><rect width="50" height="50"></rect></clipPath></defs><g id="a" clip-path="url(#b)"><g transform="translate(-12.086 -0.24)"><rect width="3" height="35" rx="1.5" transform="translate(36.399 0.479) rotate(45)"></rect><rect width="3" height="35" rx="1.5" transform="translate(38.521 47.879) rotate(135)"></rect></g><rect width="49" height="3" rx="1.5" transform="translate(1 23.5)"></rect></g></svg>
                </div>
                <div class = "popup_contents_top_right">
                    ` + getLanguage("popup_contents_bank_remittance_details_title") + `
                </div>
            </div>
            
            <div class = "popup_bank_remittance_details">
                <div class = "popup_bank_remittance_details_items">
                    <div class = "popup_bank_remittance_details_item">
                        <div class = "popup_bank_remittance_details_item_title">
                            ` + getLanguage("popup_contents_bank_remittance_details_select:title:0") + `
                        </div>
                        <div class = "popup_bank_remittance_details_item_select md-ripples" value = "` + country + `" onclick = "selectList(this, getPopupBankRemittanceCountrySelectItems());" onchange = "changeSelectPopupBankRemittanceCountry(this);">
                            <div class = "popup_bank_remittance_details_item_select_title value_title">
                                ` + getLanguage("location:" + country) + `
                            </div>
                            <div class = "popup_bank_remittance_details_item_select_icon">
                                <!-- Generated by IcoMoon.io -->
                                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.984 9.984h10.031l-5.016 5.016z"></path></svg>
                            </div>
                        </div>
                    </div>
                    <div class = "popup_bank_remittance_details_item">
                        <div class = "popup_bank_remittance_details_item_title">
                            ` + getLanguage("popup_contents_bank_remittance_details_select:title:1") + `
                        </div>
                        <div class = "popup_bank_remittance_details_item_select md-ripples" value = "` + back[0]["value"] + `" onclick = "selectList(this, getPopupBankRemittanceBankSelectItems('` + country + `'));">
                            <div class = "popup_bank_remittance_details_item_select_title value_title">
                                ` + back[0]["title"] + `
                            </div>
                            <div class = "popup_bank_remittance_details_item_select_icon">
                                <!-- Generated by IcoMoon.io -->
                                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.984 9.984h10.031l-5.016 5.016z"></path></svg>
                            </div>
                        </div>
                    </div>
                    <div class = "popup_bank_remittance_details_item">
                        <div class = "popup_bank_remittance_details_item_title">
                            ` + getLanguage("popup_contents_bank_remittance_details_input:title:0") + `
                        </div>
                        <div class = "popup_bank_remittance_details_item_input">
                            <input type = "number" placeholder = "` + getLanguage("popup_contents_bank_remittance_details_input:placeholder:0") + `" onkeydown = "checkButtonPopupBankRemittanceDetails();" onfocus = "popupBankRemittanceDetailsInputFocus(this);" onblur = "popupBankRemittanceDetailsInputBlur(this);">
                            <div class = "popup_bank_remittance_details_item_input_line_wrap"></div>
                        </div>
                    </div>
                </div>

                <div class = "popup_bank_remittance_details_description">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0 0 50 50"><defs><clipPath id="b"><rect width="50" height="50"></rect></clipPath></defs><g id="a" clip-path="url(#b)"><path d="M-215,50a24.843,24.843,0,0,1-9.731-1.965,24.918,24.918,0,0,1-7.947-5.358,24.918,24.918,0,0,1-5.358-7.947A24.843,24.843,0,0,1-240,25a24.843,24.843,0,0,1,1.965-9.731,24.918,24.918,0,0,1,5.358-7.947,24.918,24.918,0,0,1,7.947-5.358A24.843,24.843,0,0,1-215,0a24.843,24.843,0,0,1,9.731,1.965,24.918,24.918,0,0,1,7.947,5.358,24.918,24.918,0,0,1,5.358,7.947A24.843,24.843,0,0,1-190,25a24.843,24.843,0,0,1-1.965,9.731,24.918,24.918,0,0,1-5.358,7.947,24.918,24.918,0,0,1-7.947,5.358A24.843,24.843,0,0,1-215,50Zm0-47a22.025,22.025,0,0,0-22,22,22.025,22.025,0,0,0,22,22,22.025,22.025,0,0,0,22-22A22.025,22.025,0,0,0-215,3Z" transform="translate(240)"></path><circle cx="2" cy="2" r="2" transform="translate(23 9)"></circle><rect width="4" height="24" rx="2" transform="translate(23 18)"></rect></g></svg>
                    ` + getLanguage("popup_contents_bank_remittance_details_description") + `
                </div>
                <div class = "popup_bank_remittance_details_line"></div>

                <div class = "popup_bank_remittance_details_button popup_bank_remittance_details_button_disabled md-ripples" onclick = "requestEditPopupBankRemittanceDetails();">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0 0 50 50"><defs><clipPath id="b"><rect width="50" height="50"></rect></clipPath></defs><g id="a" clip-path="url(#b)"><path d="M-4.438,42.27v0L.4,28.587,21.847,7.145a2.12,2.12,0,0,1,1.506-.632,1.945,1.945,0,0,1,1.387.567l7.071,7.071a1.944,1.944,0,0,1,.567,1.433,2.125,2.125,0,0,1-.632,1.459L10.3,38.487-4.436,42.27ZM23.387,9.839h0L3.162,30.064-.327,38.621l9.154-2.892L29.052,15.5,23.387,9.839Z" transform="translate(5.102 6.536)"></path><path d="M28.7,19.1a1.987,1.987,0,0,1-1.414-.586l-7.071-7.071a2,2,0,0,1,0-2.828l6.368-6.368a2,2,0,0,1,2.829,0l7.071,7.071a2,2,0,0,1,0,2.828L30.116,18.51A1.987,1.987,0,0,1,28.7,19.1ZM27.995,5.067h0l-4.95,4.95,5.666,5.665,4.95-4.949L27.995,5.067Z" transform="translate(12.102 -0.464)"></path></g></svg>
                    ` + getLanguage("popup_contents_bank_remittance_details_button:edit") + `
                </div>
                <div class = "popup_bank_remittance_details_button md-ripples" style = "margin-top: 15px;" onclick = "requestDeletePopupBankRemittanceDetails();">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0 0 50 50"><defs><clipPath id="b"><rect width="50" height="50"></rect></clipPath></defs><g id="a" clip-path="url(#b)"><rect width="50" height="3" rx="1.5" transform="translate(0 11)"></rect><path d="M31,39H5a5.006,5.006,0,0,1-5-5V0H4.932A2,2,0,0,0,3,2V34a2,2,0,0,0,2,2H31a2,2,0,0,0,2-2V2a2,2,0,0,0-1.914-2L36,0V34A5.006,5.006,0,0,1,31,39Z" transform="translate(7 11)"></path><path d="M5,14,0,14V5A5.006,5.006,0,0,1,5,0H21a5.006,5.006,0,0,1,5,5v9H21.007A2,2,0,0,0,23,12V5a2,2,0,0,0-2-2H5A2,2,0,0,0,3,5v7a2,2,0,0,0,2,2H5Z" transform="translate(12)"></path><rect width="3" height="15" rx="1.5" transform="translate(24 22)"></rect><rect width="3" height="15" rx="1.5" transform="translate(33 22)"></rect><rect width="3" height="15" rx="1.5" transform="translate(15 22)"></rect></g></svg>
                    ` + getLanguage("popup_contents_bank_remittance_details_button:delete") + `
                </div>
            </div>

            <div style = "width: 500px;"></div>
        </div>
    `;

    return html;
}

function popupBankRemittanceDetailsInputFocus(input) {
    let parent = input.parentElement;
    parent.classList.add("popup_bank_remittance_details_item_input_line_focus");
}
function popupBankRemittanceDetailsInputBlur(input) {
    let parent = input.parentElement;
    parent.classList.remove("popup_bank_remittance_details_item_input_line_focus");
}










function checkButtonPopupBankRemittanceDetails() {
    function callback() {
        let popupContents = document.getElementsByClassName("popup_contents")[0];
        let button = popupContents.getElementsByClassName("popup_bank_remittance_details_button")[0];
        let input = popupContents.getElementsByTagName("input");
        let isWrite = true;
        
        //은행 계좌 번호
        if (isNaN(input[0].value.trim()) == true || input[0].value.trim() == "") {
            isWrite = false;
        }
    
        if (isWrite == true) {
            button.classList.remove("popup_bank_remittance_details_button_disabled");
        } else {
            button.classList.add("popup_bank_remittance_details_button_disabled");
        }
    }
    window.requestAnimationFrame(callback);
}
































function requestEditPopupBankRemittanceDetails() {
    let popupContents = document.getElementsByClassName("popup_contents")[0];
    let select = popupContents.getElementsByClassName("popup_bank_remittance_details_item_select");
    let input = popupContents.getElementsByTagName("input");
    
    popupContentsLoading();

    const xhr = new XMLHttpRequest();
    const method = "POST";
    
    xhr.open(method, "/menu/workspace/php/monetization/edit_remittance_info.php");
    
    xhr.addEventListener('readystatechange', function (event) {
        const { target } = event;
        if (target.readyState === XMLHttpRequest.DONE) {
            const { status } = target;
            if (status === 0 || (status >= 200 && status < 400)) {
                let xhrHtml = xhr.responseText.trim();

                if (xhrHtml == "changed") {
                    actionMessage(getLanguage("bank_remittance_details_edit_message"));
                } else if (xhrHtml == "added") {
                    actionMessage(getLanguage("bank_remittance_details_new_edit_message"));
                }

                history.back();
            } else {
                if (status == 504) {
                    //시간 초과
                    serverResponseErrorMessage(0);
                } else {
                    //오류 발생
                    serverResponseErrorMessage(1);
                }
            }
            popupContentsLoadingComplete();
        }
    });
    
    var formData = new FormData();
    formData.append("country", select[0].getAttribute("value"));
    formData.append("bankCode", select[1].getAttribute("value"));
    formData.append("bankAccountNumber", Number.parseInt(input[0].value.trim()));

    xhr.send(formData);
}



function requestDeletePopupBankRemittanceDetails() {
    popupContentsLoading();

    const xhr = new XMLHttpRequest();
    const method = "POST";
    
    xhr.open(method, "/menu/workspace/php/monetization/delete_remittance_info.php");
    
    xhr.addEventListener('readystatechange', function (event) {
        const { target } = event;
        if (target.readyState === XMLHttpRequest.DONE) {
            const { status } = target;
            if (status === 0 || (status >= 200 && status < 400)) {
                let xhrHtml = xhr.responseText.trim();

                actionMessage(getLanguage("bank_remittance_details_delete_message"));
                history.back();
            } else {
                if (status == 504) {
                    //시간 초과
                    serverResponseErrorMessage(0);
                } else {
                    //오류 발생
                    serverResponseErrorMessage(1);
                }
            }
            popupContentsLoadingComplete();
        }
    });

    var formData = new FormData();
    xhr.send(formData);
}







































function getPopupBankRemittanceCountrySelectItems() {
    let items = getLocationSelectItem();
    let newItems = new Array();
    for (let i = 0; i < items.length; i++) {
        if (items[i]["value"] == "kr") {
            newItems[newItems.length] = items[i];
        }
    }
    return newItems;
}
function changeSelectPopupBankRemittanceCountry(el) {
    let country = el.getAttribute("value");
    let back = getPopupBankRemittanceBankSelectItems(country);

    let popupContents = document.getElementsByClassName("popup_contents")[0];
    let select = popupContents.getElementsByClassName("popup_bank_remittance_details_item_select")[1];
    select.setAttribute("onclick", "selectList(this, getPopupBankRemittanceBankSelectItems('" + country + "'));");
    select.setAttribute("value", back[0]["value"]);
    select.getElementsByClassName("value_title")[0].innerHTML = back[0]["title"];
}
function getPopupBankRemittanceBankSelectItems(country) {
    let items = new Array();

    if (country == "kr") {
        let bankCode = new Array("011", "020", "004", "088", "081", "003", "032", "071", "031", "045", "034", "023", "039", "027", "048", "037", "089", "035", "002", "007", "064", "090", "092");
        for (let i = 0; i < bankCode.length; i++) {
            items[items.length] = {
                "title": getLanguage("kr_bank:" + bankCode[i]),
                "value": bankCode[i]
            }
        }
    }

    return items;
}