






var previousElementCreateWorkAddGenre = null;
var createWorkAddGenreCloseCancel = false;

function createWorkAddGenre(el, items) {
    let parent = el.parentElement;
    el = parent;

    let create_work_add_genre = document.getElementsByClassName("create_work_add_genre")[0];
    create_work_add_genre.style.display = "block";
    let create_work_add_genre_box = document.getElementsByClassName("create_work_add_genre_box")[0];
    create_work_add_genre_box.style.visibility = 'hidden';
    setTimeout(() => {
        create_work_add_genre_box.style.visibility = 'inherit';
        create_work_add_genre_box.style.animation = "show_create_work_add_genre 0.1s forwards";
    }, 1);
    
    previousElementCreateWorkAddGenre = el;
    setCreateWorkAddGenreItems(items);

    window.addEventListener("resize", setPositionCreateWorkAddGenre2);
    window.addEventListener("scroll", setPositionCreateWorkAddGenre2);
    setTimeout(() => {
        window.addEventListener("click", closeCreateWorkAddGenre);
    }, 1);
    
    setPositionCreateWorkAddGenre(); setPositionCreateWorkAddGenre();

    let search = document.getElementById("create_work_add_genre_box_search_input");
    search.setAttribute("placeholder", getLanguage("work_settings_genre"));
    search.value = "";
}
function setCreateWorkAddGenreItems(items) {
    let box = document.getElementById("create_work_add_genre_box_contents");
    box.innerHTML = '';
    let selected = getValueCreateWorkGenre();

    for (let i = 0; i < items.length; i++) {
        let newElement = document.createElement("div");
        newElement.setAttribute("onclick", "checkCreateWorkAddGenre(\'" + items[i].value + "\');");
        newElement.setAttribute("id", "create_work_add_genre_item_value_" + items[i].value);
        newElement.classList.add("create_work_add_genre_box_item");
        newElement.classList.add("md-ripples");
        for (let j = 0; j < selected.length; j++) {
            if (selected[j] == items[i].value) {
                newElement.classList.add("create_work_add_genre_box_item_selected");
            }
        }

        newElement.innerHTML += `
            <div class = "create_work_add_genre_box_item_left">
                <!-- Generated by IcoMoon.io -->
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M0 11l2-2 5 5 11-11 2 2-13 13z"></path></svg>
            </div>
            <div class = "create_work_add_genre_box_item_right">
                <div class = "create_work_add_genre_box_item_title">` + items[i]["title"] + `</div>
            </div>
        `;
        box.appendChild(newElement);
    }
}
function createWorkAddGenreSearch() {
    let inputValue = document.getElementById("create_work_add_genre_box_search_input").value;
    let item = document.getElementById("create_work_add_genre_box_contents").getElementsByClassName("create_work_add_genre_box_item");
    let titleList = new Array();

    if (inputValue != "") {
    
        for (let i = 0; i < item.length; i++) {
            titleList[titleList.length] = item[i].innerText.trim();
            item[i].classList.add("create_work_add_genre_box_item_disabled");
            item[i].style.order = "0";
        }
    
        let result = containsSearchList(inputValue, titleList);
        for (let i = 0; i < result.length; i++) {
            for (let j = 0; j < item.length; j++) {
                if (item[j].innerText.trim() == result[i]) {
                    item[j].classList.remove("create_work_add_genre_box_item_disabled");
                    item[j].style.order = "-1";
                }
            }
        }
    } else {
        for (let i = 0; i < item.length; i++) {
            item[i].classList.remove("create_work_add_genre_box_item_disabled");
            item[i].style.order = "-1";
        }
    }
}
function checkCreateWorkAddGenre(value) {
    let item = document.getElementById("create_work_add_genre_item_value_" + value);
    let el = previousElementCreateWorkAddGenre.getElementsByClassName("create_work_step2_genre_box_valuebox")[0];

    if (item.classList.contains("create_work_add_genre_box_item_selected")) {
        item.classList.remove("create_work_add_genre_box_item_selected");

        let valueBox = el.getElementsByClassName("create_work_add_genre_box_item_valuebox_" + value)[0].getElementsByClassName("create_work_step2_genre_box_valuebox_item_delete")[0];
        deleteCreateWorkGenreValue(valueBox);
    } else {
        item.classList.add("create_work_add_genre_box_item_selected");

        let newElement = getNewElementValueboxItem(value, item.innerText);
        el.appendChild(newElement);
    }
}
function getNewElementValueboxItem(value, title) {
    let newElement = document.createElement("div");
    newElement.classList.add("create_work_step2_genre_box_valuebox_item");
    newElement.classList.add("create_work_add_genre_box_item_valuebox_" + value);
    newElement.setAttribute("value", value);
    newElement.innerHTML = `
        ` + title + `
        <div class = "create_work_step2_genre_box_valuebox_item_delete md-ripples" onclick = "deleteCreateWorkGenreValue(this);" onmouseenter = "hoverInformation(this, getLanguage('delete'));">
            <!-- Generated by IcoMoon.io -->
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5.293 6.707l5.293 5.293-5.293 5.293c-0.391 0.391-0.391 1.024 0 1.414s1.024 0.391 1.414 0l5.293-5.293 5.293 5.293c0.391 0.391 1.024 0.391 1.414 0s0.391-1.024 0-1.414l-5.293-5.293 5.293-5.293c0.391-0.391 0.391-1.024 0-1.414s-1.024-0.391-1.414 0l-5.293 5.293-5.293-5.293c-0.391-0.391-1.024-0.391-1.414 0s-0.391 1.024 0 1.414z"></path></svg>
        </div>
    `;
    return newElement;
}
function deleteCreateWorkGenreValue(el) {
    let parent = el.parentElement;
    parent.style.width = (parent.clientWidth - 12) + "px";
    parent.style.height = parent.clientHeight + "px";
    setTimeout(() => {
        parent.style.width = "0px";
        parent.style.height = "0px";
        parent.style.paddingLeft = "0px";
        parent.style.margin = "0px";
        parent.style.fontSize = "0px";
    }, 1);

    setTimeout(() => {
        parent.remove();
    }, 200);
}
function getValueCreateWorkGenre(el) {
    if (el == null) {
        el = previousElementCreateWorkAddGenre;
    }
    let item = el.getElementsByClassName("create_work_step2_genre_box_valuebox_item");
    let array = new Array();

    for (let i = 0; i < item.length; i++) {
        array[array.length] = item[i].getAttribute("value");
    }

    return array;
}


function setPositionCreateWorkAddGenre2() {
    setPositionCreateWorkAddGenre(); setPositionCreateWorkAddGenre();
}
function setPositionCreateWorkAddGenre() {
    let el = previousElementCreateWorkAddGenre;

    let create_work_add_genre_box = document.getElementsByClassName("create_work_add_genre_box")[0];

    //width 크기
    create_work_add_genre_box.style.width = (el.offsetWidth + "px");

    let clientRect = el.getBoundingClientRect();
    let clientRect2 = create_work_add_genre_box.getBoundingClientRect();

    create_work_add_genre_box.style.top = ((clientRect.top + clientRect.height) - el.offsetHeight) + "px";
    let setLeft = (clientRect.left) - ((clientRect2.width / 2) - (clientRect.width / 2));
    create_work_add_genre_box.style.left = (setLeft + "px");


    //top
    create_work_add_genre_box.style.marginTop = "0px";

    clientRect2 = create_work_add_genre_box.getBoundingClientRect();
    let paddingHeight = 10; //여유 공간
    let height = clientRect2.height;
    let top = (clientRect2.top + height) + paddingHeight;
    let browserHeight = window.innerHeight;

    if (top > browserHeight) {
        let marginTop = top - browserHeight;
        create_work_add_genre_box.style.marginTop = "-" + marginTop + "px";
    }
    if (clientRect2.top < paddingHeight) {
        let marginTop = (clientRect2.top + (paddingHeight * -1)) * -1;
        create_work_add_genre_box.style.marginTop = marginTop + "px";
    }


    //height 제한
    create_work_add_genre_box.style.height = "max-content";

    clientRect2 = create_work_add_genre_box.getBoundingClientRect();
    height = clientRect2.height + 20;
    browserHeight = window.innerHeight;

    if (height > browserHeight) {
        create_work_add_genre_box.style.height = (clientRect2.height + (browserHeight - height)) + "px";
    }
}

function closeCreateWorkAddGenre() {
    if (createWorkAddGenreCloseCancel == false) {
        let create_work_add_genre = document.getElementsByClassName("create_work_add_genre")[0];
        setTimeout(() => {
            create_work_add_genre.style.display = "none";
        }, 100);
        let create_work_add_genre_box = document.getElementsByClassName("create_work_add_genre_box")[0];
        create_work_add_genre_box.style.animation = "hide_create_work_add_genre 0.1s forwards";
    
        window.removeEventListener("resize", setPositionCreateWorkAddGenre2);
        window.removeEventListener("scroll", setPositionCreateWorkAddGenre2);
        window.removeEventListener("click", closeCreateWorkAddGenre);
        if (previousElementCreateWorkAddGenre != null) {
            previousElementCreateWorkAddGenre = null;
        }
    } else {
        createWorkAddGenreCloseCancel = false;
    }
}