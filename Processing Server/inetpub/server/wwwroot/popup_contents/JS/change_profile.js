
function getHtmlPopupContents_change_profile() {
    let html = '';

    let premium = "";
    if (loginStatus["rankInfo"]["rank"] != 5) {
        premium = `
            <div class = "popup_contents_change_profile_premium">
                <div class = "popup_contents_change_profile_premium_icon">
                    <!-- Generated by IcoMoon.io -->
                    <svg style="animation: myProfileBuyPremium 3s infinite;" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M16 0c-8.837 0-16 7.163-16 16s7.163 16 16 16 16-7.163 16-16-7.163-16-16-16zM16 28c-6.627 0-12-5.373-12-12s5.373-12 12-12c6.627 0 12 5.373 12 12s-5.373 12-12 12z"></path></svg>
                </div>
                <div class = "popup_contents_change_profile_premium_right">
                    ` + getLanguage("popup_contents_change_profile_premium").replaceAll("{R:0}", `<b class = "md-ripples" onclick = "changeProfileMovePremium();">` + getLanguage("popup_contents_change_profile_premium_popup") + "</b>") + `
                </div>
            </div>
        `;
    } else {
        premium = `
            <div class = "popup_contents_change_profile_premium">
                <div class = "popup_contents_change_profile_premium_icon">
                    <!-- Generated by IcoMoon.io -->
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.93 17.070c-1.884-1.821-3.053-4.37-3.053-7.193 0-5.523 4.477-10 10-10 2.823 0 5.372 1.169 7.19 3.050l0.003 0.003c1.737 1.796 2.807 4.247 2.807 6.947 0 5.523-4.477 10-10 10-2.7 0-5.151-1.070-6.95-2.81l0.003 0.003zM9 5v6h2v-6h-2zM9 13v2h2v-2h-2z"></path></svg>
                </div>
                <div class = "popup_contents_change_profile_premium_right">
                    ` + getLanguage("change_profile_upload_file_big_message") + `
                </div>
            </div>
        `;
    }

    let input = "image/png, image/jpeg, image/webp, image/gif";
    if (loginStatus["rankInfo"]["rank"] == 5) {
        input = "image/png, image/jpeg, image/webp, image/gif, video/mp4, video/webm, video/x-ms-wmv, video/avi, video/x-matroska, .mov";
    }

    html = `
        <div class = "popup_contents_top">
            <div class = "popup_contents_top_left md-ripples" onclick = "backPopupContents();" onmouseenter = "hoverInformation(this, getLanguage('popup_contents:back'));">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0 0 50 50"><defs><clipPath id="b"><rect width="50" height="50"></rect></clipPath></defs><g id="a" clip-path="url(#b)"><g transform="translate(-12.086 -0.24)"><rect width="3" height="35" rx="1.5" transform="translate(36.399 0.479) rotate(45)"></rect><rect width="3" height="35" rx="1.5" transform="translate(38.521 47.879) rotate(135)"></rect></g><rect width="49" height="3" rx="1.5" transform="translate(1 23.5)"></rect></g></svg>
            </div>
            <div class = "popup_contents_top_right">
                ` + getLanguage("header_more_button_box:change_profile") + `
            </div>
        </div>
        <div class = "popup_contents_change_profile">
            <div class = "popup_contents_change_profile_top">
                <div class = "popup_contents_change_profile_title">
                    ` + getLanguage("popup_contents_change_profile_title") + `
                </div>
                <div class = "popup_contents_change_profile_description">
                    ` + getLanguage("popup_contents_change_profile_description") + `
                </div>
                <div class = "popup_contents_change_profile_line"></div>
            </div>
            <div style = "width: 100%; padding: 20px; box-sizing: border-box; position: relative; z-index: 1;">
                <div class = "popup_contents_change_profile_my_profile">
                    <div class = "profile_element">
                        <div class = "profile_info">` + JSON.stringify(loginStatus["profile"]) + `</div>
                        <div class = "profile_image"></div>
                    </div>
                </div>
            </div>
            <div class = "popup_contents_change_profile_my_profile_background_wrap">
                <div class = "popup_contents_change_profile_my_profile_background">
                    <div class = "profile_element">
                        <div class = "profile_info">` + JSON.stringify(loginStatus["profile"]) + `</div>
                        <div class = "profile_image"></div>
                    </div>
                </div>
            </div>

            <div class = "popup_contents_change_profile_bottom">
                <div class = "popup_contents_change_profile_bottom_button md-ripples" onclick = "showPopupContentsChangeProfileUpload();">
                    <div class = "popup_contents_change_profile_bottom_button_icon">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0 0 50 50"><defs><clipPath id="b"><rect width="50" height="50"></rect></clipPath></defs><g id="a" clip-path="url(#b)"><path d="M-4.438,42.27v0L.4,28.587,21.847,7.145a2.12,2.12,0,0,1,1.506-.632,1.945,1.945,0,0,1,1.387.567l7.071,7.071a1.944,1.944,0,0,1,.567,1.433,2.125,2.125,0,0,1-.632,1.459L10.3,38.487-4.436,42.27ZM23.387,9.839h0L3.162,30.064-.327,38.621l9.154-2.892L29.052,15.5,23.387,9.839Z" transform="translate(5.102 6.536)"></path><path d="M28.7,19.1a1.987,1.987,0,0,1-1.414-.586l-7.071-7.071a2,2,0,0,1,0-2.828l6.368-6.368a2,2,0,0,1,2.829,0l7.071,7.071a2,2,0,0,1,0,2.828L30.116,18.51A1.987,1.987,0,0,1,28.7,19.1ZM27.995,5.067h0l-4.95,4.95,5.666,5.665,4.95-4.949L27.995,5.067Z" transform="translate(12.102 -0.464)"></path></g></svg>
                    </div>
                    <div class = "popup_contents_change_profile_bottom_button_right">
                        ` + getLanguage("popup_contents_change_profile_button:0") + `
                    </div>
                </div>
                <div class = "popup_contents_change_profile_bottom_button md-ripples" onclick = "changeProfileDeleteButton();">
                    <div class = "popup_contents_change_profile_bottom_button_icon">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0 0 50 50"><defs><clipPath id="b"><rect width="50" height="50"/></clipPath></defs><g id="a" clip-path="url(#b)"><rect width="50" height="3" rx="1.5" transform="translate(0 11)"/><path d="M31,39H5a5.006,5.006,0,0,1-5-5V0H4.932A2,2,0,0,0,3,2V34a2,2,0,0,0,2,2H31a2,2,0,0,0,2-2V2a2,2,0,0,0-1.914-2L36,0V34A5.006,5.006,0,0,1,31,39Z" transform="translate(7 11)"/><path d="M5,14,0,14V5A5.006,5.006,0,0,1,5,0H21a5.006,5.006,0,0,1,5,5v9H21.007A2,2,0,0,0,23,12V5a2,2,0,0,0-2-2H5A2,2,0,0,0,3,5v7a2,2,0,0,0,2,2H5Z" transform="translate(12)"/><rect width="3" height="15" rx="1.5" transform="translate(24 22)"/><rect width="3" height="15" rx="1.5" transform="translate(33 22)"/><rect width="3" height="15" rx="1.5" transform="translate(15 22)"/></g></svg>
                    </div>
                    <div class = "popup_contents_change_profile_bottom_button_right">
                        ` + getLanguage("popup_contents_change_profile_button:1") + `
                    </div>
                </div>
            </div>


            <div class = "popup_contents_change_profile_upload">
                <div style = "padding: 30px 0px; padding-bottom: 40px;">
                    <div class = "popup_contents_change_profile_title">
                        ` + getLanguage("popup_contents_change_profile_upload_title") + `
                    </div>
                    <div class = "popup_contents_change_profile_description">
                        ` + getLanguage("popup_contents_change_profile_upload_description") + `
                    </div>
                    ` + premium + `
                </div>
                <input type = "file" onchange = "profile_upload_file(event);" id = "change_profile_upload_input" accept = "` + input + `" style = "display: none;">
            </div>


            <div class = "popup_contents_change_profile_bottom" style = "display: none;">
                <div class = "popup_contents_change_profile_bottom_button md-ripples" onclick = "popupContentsChangeProfileUploadButton();">
                    <div class = "popup_contents_change_profile_bottom_button_icon">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0 0 50 50"><defs><clipPath id="a"><rect width="50" height="50"/></clipPath></defs><g id="b" clip-path="url(#a)"><g clip-path="url(#a)"><rect width="3" height="25" rx="1.5" transform="translate(0 25)"/><rect width="3" height="25" rx="1.5" transform="translate(47 25)"/><rect width="50" height="3" rx="1.5" transform="translate(0 47)"/><rect width="3" height="34" rx="1.5" transform="translate(27 35.5) rotate(180)"/><rect width="3" height="17.526" rx="1.5" transform="translate(37.928 12.393) rotate(135)"/><rect width="3" height="17" rx="1.5" transform="translate(15.193 14.142) rotate(-135)"/></g></g></svg>
                    </div>
                    <div class = "popup_contents_change_profile_bottom_button_right">
                        ` + getLanguage("popup_contents_change_profile_button:2") + `
                    </div>
                </div>
                <div class = "popup_contents_change_profile_bottom_button md-ripples" onclick = "hidePopupContentsChangeProfileUpload();">
                    <div class = "popup_contents_change_profile_bottom_button_icon">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0 0 50 50"><defs><clipPath id="b"><rect width="50" height="50"/></clipPath></defs><g id="a" clip-path="url(#b)"><rect width="3" height="66.708" rx="1.5" transform="translate(47.17 0) rotate(45)"/><rect width="3" height="66.708" rx="1.5" transform="translate(50 47.17) rotate(135)"/></g></svg>
                    </div>
                    <div class = "popup_contents_change_profile_bottom_button_right">
                        ` + getLanguage("popup_contents_change_profile_button:3") + `
                    </div>
                </div>
            </div>
        </div>
        <div style = "width: 450px;"></div>
    `;

    return html;
}

function changeProfileMovePremium() {
    setHtmlPopupContents(getHtmlPopupContents_buy_premium());
}


function popupContentsChangeProfileUploadButton() {
    let input = document.getElementById("change_profile_upload_input");
    input.click();
}


function showPopupContentsChangeProfileUpload() {
    let profile_top = document.getElementsByClassName("popup_contents_change_profile_top")[0];
    let height = profile_top.clientHeight;
    profile_top.style.height = height + "px";
    profile_top.style.opacity = 1;
    function callback() {
        profile_top.style.height = "0px";
        profile_top.style.opacity = 0;
        setTimeout(() => {
            profile_top.style.opacity = null;
            profile_top.style.height = null;
            profile_top.style.display = "none";
        }, 500);
    }
    window.requestAnimationFrame(callback);

    let my_profile = document.getElementsByClassName("popup_contents_change_profile_my_profile")[0];
    let my_profile_in = my_profile.getElementsByClassName("profile_element")[0];
    my_profile.style.width = "125px";
    my_profile.style.height = "125px";
    my_profile_in.style.transition = "transform 0.75s";
    my_profile_in.style.transform = "scale(0.5) translate(-50%, -50%)";

    //프로필 배경
    let profile_background_wrap = document.getElementsByClassName("popup_contents_change_profile_my_profile_background_wrap")[0];
    if (loginStatus["profile"]["type"] == "custom") {
        profile_background_wrap.style.marginBottom = "30px";
    }

    setTimeout(() => {
        let bottom_button = document.getElementsByClassName("popup_contents_change_profile_bottom");
        bottom_button[0].style.display = "none";
        bottom_button[1].style.display = null;

        let profile_upload = document.getElementsByClassName("popup_contents_change_profile_upload")[0];
        profile_upload.style.opacity = 0;
        if (loginStatus["profile"]["type"] == "custom") {
            profile_upload.style.marginTop = "-20px";
        }
        profile_upload.style.display = "block";
        height = profile_upload.clientHeight;
        profile_upload.style.height = "0px";
        function callback2() {
            profile_upload.style.height = height + "px";
            profile_upload.style.marginTop = null;
            setTimeout(() => {
                profile_upload.style.opacity = null;
                profile_upload.style.height = null;

                //프로필 배경
                profile_background_wrap.style.opacity = 1;
            }, 500);
        }
        window.requestAnimationFrame(callback2);
    }, 600);
}
function hidePopupContentsChangeProfileUpload() {
    let profile_upload = document.getElementsByClassName("popup_contents_change_profile_upload")[0];
    let height = profile_upload.clientHeight;
    profile_upload.style.opacity = 1;
    profile_upload.style.height = height + "px";
    function callback2() {
        profile_upload.style.opacity = 0;
        profile_upload.style.height = "0px";
        setTimeout(() => {
            profile_upload.style.opacity = null;
            profile_upload.style.height = null;
            profile_upload.style.display = null;
        }, 500);
    }
    window.requestAnimationFrame(callback2);

    let my_profile = document.getElementsByClassName("popup_contents_change_profile_my_profile")[0];
    let my_profile_in = my_profile.getElementsByClassName("profile_element")[0];
    my_profile.style.width = null;
    my_profile.style.height = null;
    my_profile_in.style.transition = "transform 0.75s";
    my_profile_in.style.transform = null;

    //프로필 배경
    let profile_background_wrap = document.getElementsByClassName("popup_contents_change_profile_my_profile_background_wrap")[0];
    profile_background_wrap.style.opacity = null;
    profile_background_wrap.style.marginBottom = null;
    
    setTimeout(() => {
        let bottom_button = document.getElementsByClassName("popup_contents_change_profile_bottom");
        bottom_button[0].style.display = null;
        bottom_button[1].style.display = "none";

        let profile_top = document.getElementsByClassName("popup_contents_change_profile_top")[0];
        profile_top.style.opacity = 0;
        profile_top.style.display = null;
        height = profile_top.clientHeight;
        profile_top.style.height = "0px";
        function callback() {
            profile_top.style.height = height + "px";
            profile_top.style.opacity = 1;
            setTimeout(() => {
                profile_top.style.opacity = null;
                profile_top.style.height = null;
            }, 500);
        }
        window.requestAnimationFrame(callback);
    }, 600);
}












function changeProfileDeleteButton() {
    popupContentsLoading();

    const xhr = new XMLHttpRequest();
    const method = "POST";
    
    xhr.open(method, "/php/user/delete_profile.php");
    
    xhr.addEventListener('readystatechange', function (event) {
        const { target } = event;
        if (target.readyState === XMLHttpRequest.DONE) {
            const { status } = target;
            if (status === 0 || (status >= 200 && status < 400)) {
                let xhrHtml = xhr.responseText;

                loginCheck();
                history.back();
                actionMessage(getLanguage("change_profile_delete_message"));
    
                setTimeout(() => {
                    openPopupContents("change_profile");
                }, 300);
            } else {
                if (status == 504) {
                    //시간 초과
                    serverResponseErrorMessage(0);
                } else {
                    //오류 발생
                    serverResponseErrorMessage(1);
                }
            }
            popupContentsLoadingComplete();
        }
    });
    
    var formData = new FormData();
    xhr.send(formData);
}