

//검색 필터 기본값
var defaultSearchFilter = {
    "sort": 0,
    "workType": 0,
    "part": "all",
    "language": "all"
};

function popupSearchFilter(el) {
    let menuNumber = getCurrentMenuNumber();
    let contents = document.getElementById("contents_" + menuNumber);
    let property = JSON.parse(contents.getElementsByClassName("search_filter")[0].innerHTML);

    popupElement(el, 'top', getHtmlPopupSearchFilter(property));
    checkPopupSearchFilter();
}

function getHtmlPopupSearchFilter(property) {
    let html = '';

    let language = property["language"];
    if (language == "all") {
        language = getLanguage("popup_search_filter_value_language:all");
    } else if (language == "user_language") {
        language = getLanguage("popup_search_filter_value_language:user_language").replaceAll("{R:0}", getLanguage("language:" + userLanguage));
    } else {
        language = getLanguage("language:" + property["language"]);
    }
    let part = property["part"];
    if (part == "all") {
        part = getLanguage("popup_search_filter_value_part:all");
    } else if (part == "ending") {
        part = getLanguage("popup_search_filter_value_part:ending");
    } else {
        part = getLanguage("popup_search_filter_value_part:more").replaceAll("{R:0}", property["part"]);
    }

    html = `
        <div class = "popup_search_filter">
            <div class = "popup_search_filter_top">
                <div class = "popup_search_filter_top_left">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50"><defs><clipPath id="b"><rect width="50" height="50"></rect></clipPath></defs><g id="a" clip-path="url(#b)"><rect width="50" height="3" rx="1.5" transform="translate(0 7)"></rect><rect width="16" height="3" rx="1.5" transform="translate(0 41)"></rect><rect width="33" height="3" rx="1.5" transform="translate(0 24)"></rect></g></svg>
                </div>
                <div class = "popup_search_filter_top_right">
                    ` + getLanguage("menu_search_filter_button") + `
                </div>
            </div>
            <div class = "popup_search_filter_contents">
                <div class = "popup_search_filter_item">
                    <div class = "popup_search_filter_item_title">
                        ` + getLanguage("popup_search_filter_title:sort") + `
                    </div>
                    <div class = "popup_search_filter_item_select md-ripples" value = "` + property["sort"] + `" original_value = "` + property["sort"] + `" onchange = "checkPopupSearchFilter();" onclick = "selectList(this, getSearchFilterSelectItems('sort'));">
                        <div class = "popup_search_filter_item_select_title value_title">
                            ...
                        </div>
                        <div class = "popup_search_filter_item_select_icon">
                            <!-- Generated by IcoMoon.io -->
                            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M17.418 6.109c0.272-0.268 0.709-0.268 0.979 0s0.271 0.701 0 0.969l-7.908 7.83c-0.27 0.268-0.707 0.268-0.979 0l-7.908-7.83c-0.27-0.268-0.27-0.701 0-0.969s0.709-0.268 0.979 0l7.419 7.141 7.418-7.141z"></path></svg>
                        </div>
                    </div>
                </div>
                <div class = "popup_search_filter_item">
                    <div class = "popup_search_filter_item_title">
                        ` + getLanguage("popup_search_filter_title:work_type") + `
                    </div>
                    <div class = "popup_search_filter_item_select md-ripples" value = "` + property["workType"] + `" original_value = "` + property["workType"] + `" onchange = "checkPopupSearchFilter();" onclick = "selectList(this, getSearchFilterSelectItems('workType'));">
                        <div class = "popup_search_filter_item_select_title value_title">
                            ...
                        </div>
                        <div class = "popup_search_filter_item_select_icon">
                            <!-- Generated by IcoMoon.io -->
                            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M17.418 6.109c0.272-0.268 0.709-0.268 0.979 0s0.271 0.701 0 0.969l-7.908 7.83c-0.27 0.268-0.707 0.268-0.979 0l-7.908-7.83c-0.27-0.268-0.27-0.701 0-0.969s0.709-0.268 0.979 0l7.419 7.141 7.418-7.141z"></path></svg>
                        </div>
                    </div>
                </div>
                <div class = "popup_search_filter_item">
                    <div class = "popup_search_filter_item_title">
                        ` + getLanguage("popup_search_filter_title:part") + `
                    </div>
                    <div class = "popup_search_filter_item_select md-ripples" value = "` + property["part"] + `" original_value = "` + property["part"] + `" onchange = "checkPopupSearchFilter();" onclick = "selectList(this, getSearchFilterSelectItems('part'));">
                        <div class = "popup_search_filter_item_select_title value_title">
                            ...
                        </div>
                        <div class = "popup_search_filter_item_select_icon">
                            <!-- Generated by IcoMoon.io -->
                            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M17.418 6.109c0.272-0.268 0.709-0.268 0.979 0s0.271 0.701 0 0.969l-7.908 7.83c-0.27 0.268-0.707 0.268-0.979 0l-7.908-7.83c-0.27-0.268-0.27-0.701 0-0.969s0.709-0.268 0.979 0l7.419 7.141 7.418-7.141z"></path></svg>
                        </div>
                    </div>
                </div>
                <div class = "popup_search_filter_item">
                    <div class = "popup_search_filter_item_title">
                        ` + getLanguage("popup_search_filter_title:language") + `
                    </div>
                    <div class = "popup_search_filter_item_select md-ripples" value = "` + property["language"] + `" original_value = "` + property["language"] + `" onchange = "checkPopupSearchFilter();" onclick = "selectList(this, getSearchFilterSelectItems('language'));">
                        <div class = "popup_search_filter_item_select_title value_title">
                            ...
                        </div>
                        <div class = "popup_search_filter_item_select_icon">
                            <!-- Generated by IcoMoon.io -->
                            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M17.418 6.109c0.272-0.268 0.709-0.268 0.979 0s0.271 0.701 0 0.969l-7.908 7.83c-0.27 0.268-0.707 0.268-0.979 0l-7.908-7.83c-0.27-0.268-0.27-0.701 0-0.969s0.709-0.268 0.979 0l7.419 7.141 7.418-7.141z"></path></svg>
                        </div>
                    </div>
                </div>
            </div>
            <div class = "popup_search_filter_bottom">
                <div class = "popup_search_filter_bottom_button md-ripples" onclick = "popSearchFilterResetButton();">
                    <!-- Generated by IcoMoon.io -->
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M32 12h-12l4.485-4.485c-2.267-2.266-5.28-3.515-8.485-3.515s-6.219 1.248-8.485 3.515c-2.266 2.267-3.515 5.28-3.515 8.485s1.248 6.219 3.515 8.485c2.267 2.266 5.28 3.515 8.485 3.515s6.219-1.248 8.485-3.515c0.189-0.189 0.371-0.384 0.546-0.583l3.010 2.634c-2.933 3.349-7.239 5.464-12.041 5.464-8.837 0-16-7.163-16-16s7.163-16 16-16c4.418 0 8.418 1.791 11.313 4.687l4.687-4.687v12z"></path></svg>
                    ` + getLanguage("popup_search_filter_reset_button") + `
                </div>
                <div class = "popup_search_filter_bottom_button md-ripples" onclick = "popSearchFilterSearchButton();">
                    <!-- Generated by IcoMoon.io -->
                    <svg style = "transform: scale(1.2);" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.041 15.856c-0.034 0.026-0.067 0.055-0.099 0.087s-0.060 0.064-0.087 0.099c-1.258 1.213-2.969 1.958-4.855 1.958-1.933 0-3.682-0.782-4.95-2.050s-2.050-3.017-2.050-4.95 0.782-3.682 2.050-4.95 3.017-2.050 4.95-2.050 3.682 0.782 4.95 2.050 2.050 3.017 2.050 4.95c0 1.886-0.745 3.597-1.959 4.856zM21.707 20.293l-3.675-3.675c1.231-1.54 1.968-3.493 1.968-5.618 0-2.485-1.008-4.736-2.636-6.364s-3.879-2.636-6.364-2.636-4.736 1.008-6.364 2.636-2.636 3.879-2.636 6.364 1.008 4.736 2.636 6.364 3.879 2.636 6.364 2.636c2.125 0 4.078-0.737 5.618-1.968l3.675 3.675c0.391 0.391 1.024 0.391 1.414 0s0.391-1.024 0-1.414z"></path></svg>
                    ` + getLanguage("popup_search_filter_search_button") + `
                </div>
            </div>
        </div>
    `;

    return html;
}
function checkPopupSearchFilter() {
    let popup = document.getElementsByClassName("popup_search_filter")[0];
    let select = popup.getElementsByClassName("popup_search_filter_item_select");

    //기존 값과 다를 경우
    let isChange = false;
    let isDefault = true;
    for (let i = 0; i < select.length; i++) {
        let value = select[i].getAttribute("value");
        let originalValue = select[i].getAttribute("original_value");

        //기존 값과 다른지
        if (value != originalValue) {
            isChange = true;
        }
        //기본 값인지
        if (i == 0 && defaultSearchFilter["sort"] != value) {
            isDefault = false;
        } else if (i == 1 && defaultSearchFilter["workType"] != value) {
            isDefault = false;
        } else if (i == 2 && defaultSearchFilter["part"] != value) {
            isDefault = false;
        } else if (i == 3 && defaultSearchFilter["language"] != value) {
            isDefault = false;
        }
    }

    //검색 버튼
    let button = popup.getElementsByClassName("popup_search_filter_bottom_button");
    if (isChange == true) {
        button[1].classList.add("popup_search_filter_bottom_button_activate");
    } else {
        button[1].classList.remove("popup_search_filter_bottom_button_activate");
    }
    //초기화 버튼
    if (isDefault == false) {
        button[0].classList.add("popup_search_filter_bottom_button_activate");
    } else {
        button[0].classList.remove("popup_search_filter_bottom_button_activate");
    }

    //언어
    let language = select[3].getAttribute("value");
    if (language == "all") {
        language = getLanguage("popup_search_filter_value_language:all");
    } else if (language == "user_language") {
        language = getLanguage("popup_search_filter_value_language:user_language").replaceAll("{R:0}", getLanguage("language:" + userLanguage));
    } else {
        language = getLanguage("language:" + language);
    }
    let part = select[2].getAttribute("value");
    if (part == "all") {
        part = getLanguage("popup_search_filter_value_part:all");
    } else if (part == "ending") {
        part = getLanguage("popup_search_filter_value_part:ending");
    } else {
        part = getLanguage("popup_search_filter_value_part:more").replaceAll("{R:0}", part);
    }
    let value = select[0].getAttribute("value");
    select[0].getElementsByClassName("value_title")[0].innerHTML = getLanguage("popup_search_filter_value_sort:" + value);
    value = select[1].getAttribute("value");
    select[1].getElementsByClassName("value_title")[0].innerHTML = getLanguage("popup_search_filter_value_work_type:" + value);
    value = select[2].getAttribute("value");
    select[2].getElementsByClassName("value_title")[0].innerHTML = part;
    value = select[3].getAttribute("value");
    select[3].getElementsByClassName("value_title")[0].innerHTML = language;
}
function popSearchFilterResetButton() {
    let popup = document.getElementsByClassName("popup_search_filter")[0];
    let select = popup.getElementsByClassName("popup_search_filter_item_select");

    select[0].setAttribute("value", defaultSearchFilter["sort"]);
    select[1].setAttribute("value", defaultSearchFilter["workType"]);
    select[2].setAttribute("value", defaultSearchFilter["part"]);
    select[3].setAttribute("value", defaultSearchFilter["language"]);

    checkPopupSearchFilter();
}
function popSearchFilterSearchButton() {
    let popup = document.getElementsByClassName("popup_search_filter")[0];
    let select = popup.getElementsByClassName("popup_search_filter_item_select");

    let query = currentMenuProperty["historySearch"];
    let property = {
        "sort": select[0].getAttribute("value"),
        "workType": select[1].getAttribute("value"),
        "part": select[2].getAttribute("value"),
        "language": select[3].getAttribute("value")
    }
    
    hidePopupElement();
    loadMenu_search(query, null, true, property);
}




















function getSearchFilterSelectItems(type) {
    let items = new Array();
    if (type == "sort") {
        items[0] = {
            "title": getLanguage("popup_search_filter_value_sort:0"),
            "value": 0
        }
        items[1] = {
            "title": getLanguage("popup_search_filter_value_sort:1"),
            "value": 1
        }
        items[2] = {
            "title": getLanguage("popup_search_filter_value_sort:2"),
            "value": 2
        }
        items[3] = {
            "title": getLanguage("popup_search_filter_value_sort:3"),
            "value": 3
        }
    } else if (type == "workType") {
        items[0] = {
            "title": getLanguage("popup_search_filter_value_work_type:0"),
            "icon": '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0 0 50 50"><defs><clipPath id="b"><rect width="50" height="50"/></clipPath></defs><g id="a" clip-path="url(#b)"><path d="M25,700a1.5,1.5,0,0,1,.844.26l23.5,16A1.5,1.5,0,0,1,49.4,718.7L25.9,736.2a1.5,1.5,0,0,1-1.792,0L.6,718.7a1.5,1.5,0,0,1,.052-2.443l23.5-16A1.5,1.5,0,0,1,25,700Zm20.915,17.555L25,703.315,4.085,717.555,25,733.13Z" transform="translate(0 -700)"/><path d="M24.953,736.551a1.5,1.5,0,0,1-.9-.3L.6,718.754a1.5,1.5,0,0,1,1.794-2.4l22.558,16.832,22.65-16.834a1.5,1.5,0,1,1,1.789,2.408l-23.547,17.5A1.5,1.5,0,0,1,24.953,736.551Z" transform="translate(0 -686.551)"/></g></svg>',
            "value": 0
        }
        items[1] = {
            "title": getLanguage("work_settings_contents_type:0"),
            "icon": '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0 0 50 50"><defs><clipPath id="b"><rect width="50" height="50"/></clipPath></defs><g id="a" clip-path="url(#b)"><path d="M-72.583-761.2c-2.946-3.826-6.227-5.765-9.755-5.765h0c-6.133,0-11.229,5.774-11.281,5.833a1.5,1.5,0,0,1-1.126.517h-.006a1.5,1.5,0,0,1-1.124-.506c-3.431-3.877-7.015-5.844-10.651-5.844h0c-6.23,0-10.743,5.713-10.788,5.771a1.5,1.5,0,0,1-1.67.5A1.5,1.5,0,0,1-120-762.116v-30.063a1.5,1.5,0,0,1,.318-.922c3.574-4.578,7.7-6.9,12.273-6.9h0c5.73,0,10.491,3.7,12.606,5.656C-91.165-798.1-87.269-800-83.2-800c7.569,0,12.778,6.622,13,6.9a1.5,1.5,0,0,1,.313.917v30.063a1.5,1.5,0,0,1-1.017,1.42,1.5,1.5,0,0,1-.483.08A1.5,1.5,0,0,1-72.583-761.2Zm-20.812-4.26c2.423-1.988,6.408-4.5,11.056-4.5h0a13.728,13.728,0,0,1,9.444,3.972v-25.638a19,19,0,0,0-2.779-2.56A12.553,12.553,0,0,0-83.2-797c-3.485,0-6.913,1.867-10.191,5.549ZM-117-791.653v25.91a16.593,16.593,0,0,1,10.471-4.223h0a15.532,15.532,0,0,1,10.132,4.125v-25.873c-1.474-1.438-5.9-5.285-11.013-5.285h0C-110.882-797-114.105-795.2-117-791.653Z" transform="translate(119.895 805.308)"/></g></svg>',
            "value": 1
        }
        items[2] = {
            "title": getLanguage("work_settings_contents_type:1"),
            "icon": '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0 0 50 50"><defs><clipPath id="b"><rect width="50" height="50"/></clipPath></defs><g id="a" clip-path="url(#b)"><path d="M3,3H3V18H47V3H3M3,0H47a3,3,0,0,1,3,3V18a3,3,0,0,1-3,3H3a3,3,0,0,1-3-3V3A3,3,0,0,1,3,0Z"/><path d="M1.5,925H27a1.5,1.5,0,0,1,1.329,2.195l-11.5,22A1.5,1.5,0,0,1,15.5,950H1.508a1.5,1.5,0,0,1-1.5-1.5L0,926.5A1.5,1.5,0,0,1,1.5,925Zm23.023,3H3l.007,19H14.592Z" transform="translate(0 -900)"/><path d="M1.5,927H26a1.5,1.5,0,0,1,1.33,2.194l-11.5,22.03a1.5,1.5,0,0,1-1.33.806h-.006l-13.5-.053A1.5,1.5,0,0,1-.5,950.442L0,928.466A1.5,1.5,0,0,1,1.5,927Zm22.025,3H2.966l-.432,18.982,11.058.044Z" transform="translate(49.5 977) rotate(180)"/></g></svg>',
            "value": 2
        }
        items[3] = {
            "title": getLanguage("work_settings_contents_type:2"),
            "icon": '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0 0 50 50"><defs><clipPath id="b"><rect width="50" height="50"></rect></clipPath></defs><g id="a" clip-path="url(#b)"><path d="M121.5,500h47a1.5,1.5,0,0,1,1.5,1.5V516a1.5,1.5,0,0,1-1.218,1.473l-47,9A1.5,1.5,0,0,1,120,525V501.5A1.5,1.5,0,0,1,121.5,500Zm45.5,3H123v20.186l44-8.426Z" transform="translate(-120 -500)"></path><path d="M121.5,500h47a1.5,1.5,0,0,1,1.5,1.5V516a1.5,1.5,0,0,1-1.218,1.473l-47,9A1.5,1.5,0,0,1,120,525V501.5A1.5,1.5,0,0,1,121.5,500Zm45.5,3H123v20.186l44-8.426Z" transform="translate(170 550) rotate(180)"></path></g></svg>',
            "value": 3
        }
        items[4] = {
            "title": getLanguage("work_settings_contents_type:3"),
            "icon": '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0 0 50 50"><defs><clipPath id="b"><rect width="50" height="50"/></clipPath></defs><g id="a" clip-path="url(#b)"><path d="M6.712,1000a1.5,1.5,0,0,1,.745.2l41.052,23.5a1.5,1.5,0,0,1,0,2.6L7.458,1049.8a1.5,1.5,0,0,1-2.245-1.3v-47a1.5,1.5,0,0,1,1.5-1.5Zm38.032,25L8.212,1004.087v41.826Z" transform="translate(0.736 -1000)"/></g></svg>',
            "value": 4
        }
    } else if (type == "part") {
        items[0] = {
            "title": getLanguage("popup_search_filter_value_part:all"),
            "value": "all"
        }
        items[1] = {
            "title": getLanguage("popup_search_filter_value_part:ending"),
            "value": "ending"
        }
        items[2] = {
            "title": getLanguage("popup_search_filter_value_part:more").replaceAll("{R:0}", 50),
            "value": 50
        }
        items[3] = {
            "title": getLanguage("popup_search_filter_value_part:more").replaceAll("{R:0}", 100),
            "value": 100
        }
        items[4] = {
            "title": getLanguage("popup_search_filter_value_part:more").replaceAll("{R:0}", 150),
            "value": 150
        }
        items[5] = {
            "title": getLanguage("popup_search_filter_value_part:more").replaceAll("{R:0}", 200),
            "value": 200
        }
        items[6] = {
            "title": getLanguage("popup_search_filter_value_part:more").replaceAll("{R:0}", 250),
            "value": 250
        }
        items[7] = {
            "title": getLanguage("popup_search_filter_value_part:more").replaceAll("{R:0}", 300),
            "value": 300
        }
    } else if (type == "language") {
        items[0] = {
            "title": getLanguage("popup_search_filter_value_language:all"),
            "value": "all"
        }
        items[1] = {
            "title": getLanguage("popup_search_filter_value_language:user_language").replaceAll("{R:0}", getLanguage("language:" + userLanguage)),
            "value": "user_language"
        }
        for (let i = 0; i < languages.length; i++) {
            items[items.length] = {
                "title": getLanguage("language:" + languages[i]),
                "value": languages[i]
            }
        }
    }

    return items;
}