

var isShowActionMessage = false;
var previousActionMessageTimeout = null;

function actionMessage(message, undo) {
    let time = 5; //초

    let box = document.getElementsByClassName("action_message_box")[0];
    box.style.animation = "hide_action_message 0s forwards";

    setTimeout(() => {
        if (timeoutHideActionMessage != null) {
            clearTimeout(timeoutHideActionMessage);
        }

        //SVG
        let svg = '<!-- Generated by IcoMoon.io --><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="24" height="24" viewBox="0 0 24 24"><path d="M23 12c0-3.037-1.232-5.789-3.222-7.778s-4.741-3.222-7.778-3.222-5.789 1.232-7.778 3.222-3.222 4.741-3.222 7.778 1.232 5.789 3.222 7.778 4.741 3.222 7.778 3.222 5.789-1.232 7.778-3.222 3.222-4.741 3.222-7.778zM21 12c0 2.486-1.006 4.734-2.636 6.364s-3.878 2.636-6.364 2.636-4.734-1.006-6.364-2.636-2.636-3.878-2.636-6.364 1.006-4.734 2.636-6.364 3.878-2.636 6.364-2.636 4.734 1.006 6.364 2.636 2.636 3.878 2.636 6.364z"/></svg>';
        
        let dm_text = document.getElementsByClassName("action_message_box_text")[0];
        dm_text.innerHTML = (svg + message);
        let dm_undo = document.getElementsByClassName("action_message_box_undo")[0];
        if (undo != null) {
            dm_undo.style.display = "block";
            dm_undo.innerText = getLanguage("action_message_undo");
            dm_undo.setAttribute("onclick", undo + " hideActionMessage();");
        } else {
            dm_undo.style.display = "none";
        }
    
        box.style.animation = "show_action_message 0.2s forwards";
        box.style.display = "flex";
        isShowActionMessage = true;
    
        if (previousActionMessageTimeout != null) {
            clearTimeout(previousActionMessageTimeout);
        }
        previousActionMessageTimeout = setTimeout(() => {
            box.style.animation = "hide_action_message 0.2s forwards";
            setTimeout(() => {
                box.style.display = "none";
                isShowActionMessage = false;
            }, 200);
            previousActionMessageTimeout = null;
        }, time * 1000);
    }, 10);
}

var timeoutHideActionMessage = null;
function hideActionMessage() {
    let box = document.getElementsByClassName("action_message_box")[0];
    box.style.animation = "hide_action_message 0.2s forwards";
    timeoutHideActionMessage = setTimeout(() => {
        box.style.display = "none";
    }, 200);
}

function checkActionMessage() {
    let footer = document.getElementsByTagName("footer")[0];
    if (footer != null && isShowActionMessage == true) {
        let menuName = getCurrentMenuName(); 
        let menuNumber = getCurrentMenuNumber(); 
        let contents = document.getElementById("contents_" + menuNumber);
        let media = matchMedia("screen and (max-width: 700px)");
        let action_message_box = document.getElementsByClassName("action_message_box")[0];

        //일반 상태
        if (isShowMobileSearch == true) {
            //모바일 검색 상태
            action_message_box.classList.remove("action_message_box_isFooter");
        } else if (menuName == "novel_viewer") {
            if (contents.getElementsByClassName("novel_viewer_side_menu").length != 0) {
                let side_menu = contents.getElementsByClassName("novel_viewer_side_menu")[0];
                if (side_menu.classList.contains("show_novel_viewer_side_menu")) {
                    action_message_box.classList.add("action_message_box_isFooter");
                } else {
                    action_message_box.classList.remove("action_message_box_isFooter");
                }
            }
        } else if (menuName == "image_format_viewer") {
            if (contents.getElementsByClassName("image_format_viewer_footer").length != 0) {
                let side_menu = contents.getElementsByClassName("image_format_viewer_footer")[0];
                if (side_menu.classList.contains("show_image_format_viewer_footer")) {
                    action_message_box.classList.add("action_message_box_isFooter");
                } else {
                    action_message_box.classList.remove("action_message_box_isFooter");
                }
            }
        } else {
            if (media.matches == false || (footer.classList.contains("footer_nothing") && menuName != 'novel_viewer' && menuName != 'image_format_viewer') == true || isShowPopupContents == true) {
                action_message_box.classList.remove("action_message_box_isFooter");
            } else {
                action_message_box.classList.add("action_message_box_isFooter");
            }
        }
    
        //모바일 더보기 버튼
        let mobile_more = document.getElementsByClassName("mobile_more_button_box")[0];
        if (isShowMobileMoreButtonBox == true) {
            action_message_box.classList.remove("action_message_box_isFooter");
            action_message_box.style.marginBottom = (mobile_more.clientHeight + 30) + "px";
            return;
        }

        //Popup element
        let popup_element_box = document.getElementsByClassName("popup_element_box")[0];
        if (media.matches == true && previousElementPopupElement != null) {
            action_message_box.classList.remove("action_message_box_isFooter");
            action_message_box.style.marginBottom = (popup_element_box.clientHeight + 15) + "px";
            return;
        }

        action_message_box.style.marginBottom = null;
    }
}
function registerActionMessage() {
    let previousTimestamp = null;
    function callback(timestamp) {
        if (previousTimestamp === timestamp) { return };
        previousTimestamp = timestamp;
        
        checkActionMessage();
        window.requestAnimationFrame(callback);
    }
    window.requestAnimationFrame(callback);
}
registerActionMessage();